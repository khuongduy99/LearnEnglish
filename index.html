<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>H·ªçc t·ª´ v·ª±ng - Quiz nhi·ªÅu ch·ªß ƒë·ªÅ</title>
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f2f4f8; display:flex; justify-content:center; align-items:flex-start; min-height:100vh; }
.container { background:#fff; width:95%; max-width:500px; margin:20px; padding:20px; border-radius:12px; box-shadow:0 10px 25px rgba(0,0,0,0.1); text-align:center; }
h1 { color:#333; margin-bottom:20px; }
.topic-list { text-align:left; margin-bottom:20px; }
.topic-list label { display:block; margin:5px 0; font-size:16px; cursor:pointer; }
button, select { padding:10px 15px; font-size:16px; border-radius:8px; border:none; cursor:pointer; margin-bottom:20px; background:#007bff; color:black; }
select { width:100%; background:#fff; color:#333; border:1px solid #ccc; }
.word { font-size:24px; font-weight:bold; margin-bottom:10px; color:#007bff; }
.options, #fillInputDiv { display:flex; flex-direction:column; margin-top:10px; align-items:center; }
button.correct { background:#28a745; color:#fff; }
button.wrong { background:#dc3545; color:#fff; }
#nextBtn { margin-top:15px; padding:12px; width:100%; font-size:16px; border:none; border-radius:8px; background:#007bff; color:#fff; cursor:pointer; display:none; }
input[type="text"] { padding:10px; font-size:16px; border-radius:8px; border:1px solid #ccc; width:80%; margin-bottom:10px; }
@media(max-width:480px){ .word{font-size:20px;} button.option{font-size:14px;} #nextBtn{font-size:14px;} input[type="text"]{font-size:14px;} }
/* N·∫øu h·ªá th·ªëng ƒëang dark mode */
@media (prefers-color-scheme: dark) {
    h1 {color:  white}
    button, select {
        background:#333;
        color:#fff;
    }
    button.option { background:#555; color:#fff; }
    /* hover ch·ªâ √°p d·ª•ng v·ªõi button ch∆∞a ƒë∆∞·ª£c ch·ªçn */
    button.option:not(.correct):not(.wrong):hover {
        background:#666;
    }
}

@media (prefers-color-scheme: light) {

    /* hover ch·ªâ √°p d·ª•ng v·ªõi button ch∆∞a ƒë∆∞·ª£c ch·ªçn */
    button.option:not(.correct):not(.wrong):hover {
        background:#ddd;
    }

}

button.option {
    margin:5px 0;
    padding:12px;
    font-size:16px;
    border-radius:8px;
    border:none;
    cursor:pointer;
    background:#eee;
    transition:0.2s;
    width:100%;
}

    /* button ƒë√∫ng */
    button.correct {
        background:#28a745;
        color:#fff;
        cursor: default;
    }

    /* button sai */
    button.wrong {
        background:#dc3545;
        color:#fff;
        cursor: default;
    }

</style>
</head>
<body>

<div class="container">
<h1>üìò Quiz t·ª´ v·ª±ng nhi·ªÅu ch·ªß ƒë·ªÅ</h1>

<!-- Checkbox menu ch·ªçn nhi·ªÅu CSV -->
<div class="topic-list" id="topicList">
  <label><input type="checkbox" value="contracts.csv"> Contracts</label>
  <label><input type="checkbox" value="marketing.csv"> Marketing</label>
</div>

<button onclick="loadSelectedTopics()" style="color: white;">Load Quiz</button>

<!-- Ch·ªçn lo·∫°i quiz -->
<select id="quizTypeSelect">
  <option value="mc">Multiple Choice</option>
  <option value="fill">ƒêi·ªÅn t·ª´</option>
<option value="pos">Ch·ªçn lo·∫°i t·ª´ (POS)</option>
  <option value="mix">Tr·ªôn MC & ƒêi·ªÅn t·ª´</option>
</select>

<div class="progress" id="progress" style="margin-bottom:10px; color:#555;"></div>
<div class="word" id="word">Ch·ªçn ch·ªß ƒë·ªÅ ƒë·ªÉ b·∫Øt ƒë·∫ßu</div>
<div class="options" id="options"></div>

<!-- Fill-in input -->
<div id="fillInputDiv" style="display:none;">
  <input type="text" id="fillInput" placeholder="Nh·∫≠p t·ª´ ti·∫øng Anh"/>
  <button onclick="checkFillAnswer()">Ki·ªÉm tra</button>
</div>

<button id="nextBtn" onclick="nextQuestion()">Ti·∫øp theo ‚û°Ô∏è</button>
</div>

<script>
let vocab = [];
let currentIndex = 0;

// Khi load quiz t·ª´ c√°c ch·ªß ƒë·ªÅ ƒë√£ ch·ªçn
function loadSelectedTopics() {
    const checkboxes = document.querySelectorAll('#topicList input[type="checkbox"]:checked');
    const selectedFiles = Array.from(checkboxes).map(cb => cb.value);
    if(selectedFiles.length === 0) return alert("Vui l√≤ng ch·ªçn √≠t nh·∫•t 1 ch·ªß ƒë·ªÅ");

    vocab = [];
    currentIndex = 0;

    let fetches = selectedFiles.map(file => fetch(file).then(res => res.text()));

    Promise.all(fetches)
        .then(results => {
            results.forEach(text => {
                const lines = text.trim().split("\n");
                lines.slice(1).forEach(line => {
                    const cols = line.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
                    vocab.push({
                        word: cols[0],
                        type: cols[1],
                        meaning: cols[2].replace(/"/g,""),
                        example: cols[3].replace(/"/g,""),
                        viet_example: cols[4].replace(/"/g,"")
                    });
                });
            });
            vocab.sort(() => Math.random()-0.5);
            showQuestion();
        })
        .catch(err => console.error("Kh√¥ng load ƒë∆∞·ª£c CSV", err));
}

// T·∫°o ƒë√°p √°n ABCD
function getOptions(correctMeaning) {
    const meanings = vocab.map(v => v.meaning);
    let options = [correctMeaning];
    while(options.length < 4){
        const rand = meanings[Math.floor(Math.random()*meanings.length)];
        if(!options.includes(rand)) options.push(rand);
    }
    return options.sort(() => Math.random()-0.5);
}

// Hi·ªÉn th·ªã c√¢u h·ªèi
function showQuestion() {
    if(vocab.length===0) return;
    const q = vocab[currentIndex];
    let quizType = document.getElementById("quizTypeSelect").value;

    // N·∫øu ch·ªçn mix ‚Üí random MC ho·∫∑c Fill-in
    if(quizType === "mix"){
        quizType = Math.random() < 0.5 ? "mc" : "fill";
    }

    // Hi·ªÉn th·ªã ti·∫øn tr√¨nh
    document.getElementById("progress").innerText = `C√¢u ${currentIndex+1} / ${vocab.length}`;

    const optionsDiv = document.getElementById("options");
    const fillDiv = document.getElementById("fillInputDiv");
    optionsDiv.innerHTML = "";
    fillDiv.style.display = "none";

    if(quizType === "mc") {
        document.getElementById("word").innerText = `${q.word} (${q.type})`;
        optionsDiv.style.display = "flex";
        const opts = getOptions(q.meaning);
        opts.forEach(opt=>{
            const btn = document.createElement("button");
            btn.className = "option";
            btn.innerText = opt;
            btn.onclick = ()=>checkAnswer(btn,opt,q.meaning);
            optionsDiv.appendChild(btn);
        });
    } else if(quizType === "fill") {
        document.getElementById("word").innerText = `${q.meaning}`;
        optionsDiv.style.display = "none";
        fillDiv.style.display = "flex";
        document.getElementById("fillInput").value = "";
        document.getElementById("fillInput").disabled = false;
    } else if(quizType === "pos") {
        document.getElementById("word").innerText = q.word;
        optionsDiv.style.display = "flex";
        const posOptions = ["v", "adj", "n", "adv"];
        posOptions.sort(() => Math.random() - 0.5); // tr·ªôn ng·∫´u nhi√™n
        posOptions.forEach(opt=>{
            const btn = document.createElement("button");
            btn.className = "option";
            btn.innerText = opt;
            btn.onclick = ()=>checkAnswer(btn,opt,q.type);
            optionsDiv.appendChild(btn);
        });
    }

    document.getElementById("nextBtn").style.display = "none";
}



// Ki·ªÉm tra MC
function checkAnswer(btn, selected, correct) {
    const allBtns = document.querySelectorAll("button.option");
    allBtns.forEach(b=>b.disabled=true);
    if(selected===correct){
        btn.classList.add("correct");
    } else {
        btn.classList.add("wrong");
        allBtns.forEach(b=>{
            if(b.innerText===correct) b.classList.add("correct");
        });
    }
    document.getElementById("nextBtn").style.display = "block";
}

// Ki·ªÉm tra Fill-in
function checkFillAnswer() {
    const q = vocab[currentIndex];
    const input = document.getElementById("fillInput").value.trim().toLowerCase();
    const nextBtn = document.getElementById("nextBtn");
    const fillDiv = document.getElementById("fillInputDiv");
    const optionsDiv = document.getElementById("options");
    
    // Disable input
    document.getElementById("fillInput").disabled = true;
    
    if(input === q.word.toLowerCase()){
        alert("‚úÖ Ch√≠nh x√°c!");
    } else {
        alert(`‚ùå Sai! ƒê√°p √°n ƒë√∫ng: ${q.word}`);
    }
    nextBtn.style.display = "block";
}

// C√¢u ti·∫øp theo
function nextQuestion() {
    currentIndex = (currentIndex + 1) % vocab.length;
    showQuestion();
}
</script>

</body>
</html>
